---
title: sed命令
date: 2018-04-01 00:31:30
tags: [linux]
categories: [linux]
---
处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有 改变，除非你使用重定向存储输出(-i)。

## sed
处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有 改变，除非你使用重定向存储输出(-i)。

#### 命令格式
sed [options] 'command' file(s)
sed [options] -f scriptfile file(s)

注意mac系统不支持sed命令：
sed -h

```
sed: illegal option -- h
usage: sed script [-Ealn] [-i extension] [file ...]
       sed [-Ealn] [-i extension] [-e script] ... [-f script_file] ... [file ...]
```

#### 参数列表
-e<script> 或者 —expresssion=<script>：以选项中的指定的script来处理输入的文本，可以接受多个表达式。
-f<script文件>或者—file=<script文件>：以选项中指定的script文件处理输入的文本
-h 或者—help：显示帮助
-n或--quiet或——silent：仅显示script处理后的结果；
-V或--version：显示版本信息。

#### 命令列表

```
a\ 在当前行下面插入文本。
i\ 在当前行上面插入文本。
c\ 把选定的行改为新的文本。
d 删除，删除选择的行。
D 删除模板块的第一行。
s 替换指定字符
h 拷贝模板块的内容到内存中的缓冲区。
H 追加模板块的内容到内存中的缓冲区。
g 获得内存缓冲区的内容，并替代当前模板块中的文本。
G 获得内存缓冲区的内容，并追加到当前模板块文本的后面。
l 列表不能打印字符的清单。
n 读取下一个输入行，用下一个命令处理新的行而不是用第一个命令。
N 追加下一个输入行到模板块后面并在二者间嵌入一个新行，改变当前行号码。
p 打印模板块的行。
P(大写) 打印模板块的第一行。
q 退出Sed。
b lable 分支到脚本中带有标记的地方，如果分支不存在则分支到脚本的末尾。
r file 从file中读行。
t label if分支，从最后一行开始，条件一旦满足或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。
T label 错误分支，从最后一行开始，一旦发生错误或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。
w file 写并追加模板块到file末尾。  
W file 写并追加模板块的第一行到file末尾。  
! 表示后面的命令对所有没有被选定的行发生作用。  
= 打印当前行号码。  
```

#### sed替换标记

```
g 表示行内全面替换。  
p 表示打印行。  
w 表示把行写入一个文件。  
x 表示互换模板块中的文本和缓冲区中的文本。  
y 表示把一个字符翻译为另外的字符（但是不用于正则表达式）
\1 子串匹配标记
& 已匹配字符串标记变量
```

#### 表达符集

```
^ 匹配行开始，如：/^sed/匹配所有以sed开头的行。
$ 匹配行结束，如：/sed$/匹配所有以sed结尾的行。
. 匹配一个非换行符的任意字符，如：/s.d/匹配s后接一个任意字符，最后是d。
* 匹配0个或多个字符，如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。
[] 匹配一个指定范围内的字符，如/[ss]ed/匹配sed和Sed。  
[^] 匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。
\(..\) 匹配子串，保存匹配的字符，如s/\(love\)able/\1rs，loveable被替换成lovers。
& 保存搜索字符用来替换其他字符，如s/love/**&**/，love这成**love**。
\< 匹配单词的开始，如:/\<love/匹配包含以love开头的单词的行。
\> 匹配单词的结束，如/love\>/匹配包含以love结尾的单词的行。
x\{m\} 重复字符x，m次，如：/0\{5\}/匹配包含5个0的行。
x\{m,\} 重复字符x，至少m次，如：/0\{5,\}/匹配至少有5个0的行。
x\{m,n\} 重复字符x，至少m次，不多于n次，如：/0\{5,10\}/匹配5~10个0的行。
```

#### 实践

1. 替换文本
```
sed 's/1/111111/' bb.txt   //将1替换为111111输出到屏幕，但不会改变文件
Sed -I ’s/1/11111111/’ bb.txt  //文件被修改
Sed -I ’s/1/11111111/Ng’ bb.txt  //每行从匹配到的第n个开始替换
```

2. 删除文本
```
Sed ‘/^$/d’ bb.txt   //删除空白行，匹配删除
Sed ‘2d’ bb.txt
Sed ‘2,$d’ bb.txt  //删除从第二行到结束
sed 's/1/&添加/g' bb.txt  //匹配每一行的1并将1+添加写入匹配到的位置
```

引用：”” 包含该变量

3. 文件间操作

从文件读入：r命令

```

file里的内容被读进来，显示在与test匹配的行后面，如果匹配多行，则file的内容将显示在所有匹配行的下面： 
sed '/test/r file' filename

```

写入文件：w命令  

```

在example中所有包含test的行都被写入file里：
sed -n '/test/w file' example

```

插入内容：

```

sed -i '/1/a\这' bb.txt 在匹配到的行后追加一行

sed -i '/1/i\这' bb.txt 在匹配到的行前追加一行

sed -i '1i\追加第一行' bb.txt 在第几行添加

```


下一行：

```

如果test被匹配，则移动到匹配行的下一行，替换这一行的aa，变为bb，并打印该行，然后继续：
sed '/test/{ n; s/aa/bb/; }' file

```

退出命令：

```

打印完第10行后，退出sed
sed '10q' file

```


